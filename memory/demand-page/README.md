# デマンドページングの検証用プログラム
## 概要
`mmap(2)`により所定の仮想メモリを確保し、確保した仮想メモリに対して書き込み処理を2回行い所要時間を比較する。  
1回目の書き込みでは仮想メモリに対する物理メモリの割り当てが行われていないため、書き込みの伴い物理メモリの確保(デマンドページング)が行われる。  
2回目は1回目で物理メモリが確保されているため、仮想メモリへの物理メモリ割り当ては行われず書き込み処理のみが行われる。

- mmap(2)(https://linuxjm.osdn.jp/html/LDP_man-pages/man2/mmap.2.html)
- syscall.Mmap(https://pkg.go.dev/syscall#Mmap)

## Quick Start

ビルド
```
$ go build ./demand-page.go 
```

実行
```
mmap()により仮想メモリを100MiB取得します。(1ページ= 4096 byte)
*Press Enter

mmap()により仮想メモリを100MiB取得しました。
=========================================================
各ページへの1回目の書き込みを行い物理メモリを取得します。(デマンドページング)
*Press Enter

所要時間: 31344μs
各ページへの1回目の書き込みおよび物理メモリの取得が完了しました。
*Press Enter

=========================================================
各ページへの2回目の書き込みを行います。(1回目の書き込みにより物理メモリは確保済み)
*Press Enter

所要時間: 419μs
各ページへの2回目の書き込みが完了しました。
*Press Enter
```

`demand-page`起動後に`capture.sh`を起動することで以下モニタリングが可能。

- 第1フィールド: 獲得済メモリ領域のサイズ
- 第2フィールド: 獲得済物理メモリのサイズ
- 第3フィールド: メジャーフォールトの数
- 第4フィールド: マイナーフォールトの数

```
$ ./capture.sh
Fri Feb  3 12:45:03 AM JST 2023: 711028  1696      0    240
Fri Feb  3 12:45:04 AM JST 2023: 711028  1696      0    240
Fri Feb  3 12:45:05 AM JST 2023: 711028  1696      0    240
Fri Feb  3 12:45:06 AM JST 2023: 711028  1696      0    240
Fri Feb  3 12:45:07 AM JST 2023: 813428  1696      0    243
Fri Feb  3 12:45:08 AM JST 2023: 813428  1696      0    243
Fri Feb  3 12:45:09 AM JST 2023: 813428  1696      0    243
Fri Feb  3 12:45:10 AM JST 2023: 813428 103860     0  25844
Fri Feb  3 12:45:11 AM JST 2023: 813428 103860     0  25844
Fri Feb  3 12:45:12 AM JST 2023: 813428 103860     0  25844
Fri Feb  3 12:45:13 AM JST 2023: 813428 103860     0  25844
Fri Feb  3 12:45:14 AM JST 2023: 813428 103860     0  25844
Fri Feb  3 12:45:15 AM JST 2023: demand-pagingプロセスは終了しました
```